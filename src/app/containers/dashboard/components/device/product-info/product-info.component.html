<ng-progress
  #progressBar
  [meteor]="_options.meteor"
  [color]="_options.color"
  [min]="_options.min"
  [speed]="_options.speed"
  [spinner]="_options.spinner"
  [max]="_options.max"
  [spinnerPosition]="_options.spinnerPosition"
  [direction]="_options.direction"
  [thick]="_options.thick"
  [trickleSpeed]="_options.trickleSpeed"
  [ease]="_options.ease"
>
</ng-progress>
<div class="flexRow whole__content" *ngIf="!isLoading">
  <div class="flexCol col-md-4 product-info" style="align-items: center;">
    <img *ngIf="!deviceInfo" src={{noProductImg}}>
    <img style="height: 40vw; max-height: 300px; min-height: 200px;" *ngIf="deviceInfo" src={{deviceImgUrl}}>
    <span
      style="margin-top: 20px;"
      class="product__page__tab"
      [class.product__tab__active]="uiFlag.page === 'productInfo'"
      (click)="switchPage('productInfo')"
    >產品資訊</span>
    <span
      class="product__page__tab"
      [class.product__tab__active]="uiFlag.page === 'productLog'"
      (click)="switchPage('productLog')"
      *ngIf="userMaxAccessRight <= 29"
    >設備日誌</span>
  </div>
  <ng-container *ngIf="uiFlag.page === 'productInfo'">
    <div style="width: 100%;" class="info__content">
      <div style="display: flex; justify-content: flex-end;">
        <div class="flexRow btn__section">
          <button class="alatech-btn alatech-btn--default activty-btn"
            title="{{'universal_operating_finishEdit' | translate}}"
            style="width: 140px;height: 38px;"
            (click)="manage()"
          >
            {{'universal_operating_finishEdit' | translate}}
          </button>
          <button
            class="alatech-btn alatech-btn--default activty-btn"
            title="{{'universal_operating_back' | translate}}"
            style="width: 140px;height: 38px; margin: 0;"
            (click)="goBack()"
          >
            {{'universal_operating_back' | translate}}
          </button>
        </div>
      </div>
      <div class="group-edit-bar">
        <span class="group-handle-name">
          {{'universal_deviceSetting_productInfo' | translate}}
        </span>
      </div>
      <div style="color: #919191">
        <div class="info__item">
          {{"universal_deviceSetting_deviceSerialNumber" | translate}}：{{ deviceSN || 'universal_status_noData' | translate }}
        </div>
        <div class="info__item">
          {{"universal_deviceSetting_modeCode" | translate}}：{{ deviceInfo?.modelName || 'universal_status_noData' | translate }}
        </div>
        <div class="info__item">
          {{"universal_deviceSetting_modeType" | translate}}：{{ (deviceInfo?.modelTypeID | productType | translate) || 'universal_status_noData' | translate }}
        </div>
        <div class="info__item">
          {{'universal_deviceSetting_dateOfManufacture' | translate}}：{{ deviceInfo?.date || 'universal_status_noData' | translate }}
        </div>
        <div class="info__item" *ngIf="userMaxAccessRight < 30">
          啟用日期：{{ deviceEnableDate || 'universal_status_noData' | translate }}
        </div>
        <div class="info__item" *ngIf="userMaxAccessRight < 30">
          註冊日期：{{ deviceBondDate || 'universal_status_noData' | translate }}
        </div>
        <div class="info__item" *ngIf="userMaxAccessRight < 30">使用時間：{{ totalUseTime || '-:-:-' }}</div>
        <div class="info__item" *ngIf="userMaxAccessRight < 30">總里程數：{{ totalUseKiloMeter || '-' }} km</div>
        <div class="info__item">
          Fit pair {{'universal_vocabulary_object' | translate}}：
          <select  [(ngModel)]="fitPairStatus" style="width: 186px">
            <option value="0">{{'universal_uiFitpair_private' | translate}}</option>
            <option value="1">{{'universal_privacy_onlyMe' | translate}},{{'universal_uiFitpair_avatarAndSportFile' | translate}}</option>
            <option value="2">{{'universal_privacy_onlyMe' | translate}},{{'universal_uiFitpair_onlySportFile' | translate}}</option>
            <option value="3">{{'universal_uiFitpair_openToAnyone' | translate}}</option>
          </select>
          <div class="device-hint"
            (mouseenter)="mouseEnter()"
            (mouseleave)="mouseLeave()"
          >
            ※Fit pair
            <div class="device-hint-box" *ngIf="isDisplayBox" [innerHTML]="fitPairTip"></div>
          </div>
        </div>
      </div>

        <div class="app-link" *ngIf="deviceInfo?.mainAppData">
          <div>
            <span class="group-handle-name">{{"universal_deviceSetting_mainApp" | translate}}：</span>
            <div style="margin: 25px 0">
              <img src={{deviceInfo?.mainAppData.appIconUrl}}  (click)="swithMainApp()">
            </div>
            <ng-container *ngIf="isMainAppOpen">
              <div style="margin-bottom:10px" *ngIf="deviceInfo?.mainAppData.appIosUrl.length > 0">
                <a target="_blank" href={{deviceInfo?.mainAppData.appIosUrl}}>
                  <img src={{deviceInfo?.mainAppData.appIosImg}}>
                </a>
              </div>
              <div style="margin-bottom:10px" *ngIf="deviceInfo?.mainAppData.appAndroidUrl.length > 0">
                <a target="_blank" href={{deviceInfo?.mainAppData.appAndroidUrl}}>
                  <img src={{deviceInfo?.mainAppData.appAndroidImg}}>
                </a>
              </div>
              <div style="margin-bottom:10px" *ngIf="deviceInfo?.mainAppData.appApkUrl.length > 0">
                <a target="_blank" href={{deviceInfo?.mainAppData.appApkUrl}}>
                  <img src={{deviceInfo?.mainAppData.appApkImg}}>
                </a>
              </div>
            </ng-container>
          </div>
        </div>
        <div class="app-link" *ngIf="deviceInfo?.secondaryAppData">
          <div>
            <span class="group-handle-name">{{"universal_deviceSetting_otherApp" | translate}}：</span>
            <div style="margin: 25px 0">
              <img src={{deviceInfo?.secondaryAppData.appIconUrl}}  (click)="swithSecondApp()">
            </div>
            <ng-container *ngIf="isSecondAppOpen">
              <div style="margin-bottom:10px" *ngIf="deviceInfo?.secondaryAppData.appIosUrl.length > 0">
                <a target="_blank" href={{deviceInfo?.secondaryAppData.appIosUrl}}>
                  <img src={{deviceInfo?.secondaryAppData.appIosImg}}>
                </a>
              </div>
              <div style="margin-bottom:10px" *ngIf="deviceInfo?.secondaryAppData.appAndroidUrl.length > 0">
                <a target="_blank" href={{deviceInfo?.secondaryAppData.appAndroidUrl}}>
                  <img src={{deviceInfo?.secondaryAppData.appAndroidImg}}>
                </a>
              </div>
              <div style="margin-bottom:10px" *ngIf="deviceInfo?.secondaryAppData.appApkUrl.length > 0">
                <a target="_blank" href={{deviceInfo?.secondaryAppData.appApkUrl}}>
                  <img src={{deviceInfo?.secondaryAppData.appApkImg}}>
                </a>
              </div>
            </ng-container>
          </div>
        </div>
        <ng-containr *ngIf="productInfo && productInfo.length > 0">
          <span class="group-handle-name">{{"universal_deviceSetting_relatedLinks" | translate}}：</span>
          <div class="app-link" *ngIf="productInfo && productInfo.length > 0">

            <div *ngFor="let info of productInfo">
              <a target="_blank" href={{info?.link}}>{{info?.dispName}}</a>
            </div>
          </div>
        </ng-containr>
        <ng-container *ngIf="productManual && productManual.length > 0">
          <span class="group-handle-name">{{"universal_vocabulary_manual" | translate}}：</span>
          <div class="app-link" *ngIf="productManual && productManual.length > 0">
            <div>
              <a target="_blank" href={{productManual}}>{{"universal_deviceSetting_deviceManual" | translate}}</a>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="qrURL">
          <span class="group-handle-name">{{'universal_uiFitpair_createFitpairQr' | translate}}：</span>
          <div style="border: 20px solid white; width: fit-content">
            <qrcode [qrdata]="qrURL" [size]="128" [level]="'M'"></qrcode>
          </div>
        </ng-container>
        <ng-container *ngIf="isAdminMode">
          <span class="group-handle-name">註冊持有人：</span>{{deviceBondUserName}}
          <div style="margin: 25px 0">
          <button class="alatech-btn alatech-btn--default activty-btn"
            title="{{'universal_uiFitpair_unbind' | translate}} {{'universal_deviceSetting_device' | translate}}"
            style="width: 140px;height: 38px;"
            (click)="openUnBondDeviceDialog()"
          >
            {{'universal_uiFitpair_unbind' | translate}} {{'universal_deviceSetting_device' | translate}}
          </button>
          </div>
        </ng-container>
    </div>
  </ng-container>
  <ng-container *ngIf="uiFlag.page === 'productLog' && userMaxAccessRight <= 29">
    <main class="col-md-8">
      <section class="flexCol">
        <span class="group-handle-name" style="margin-bottom: 30px;">設備日誌</span>
        <span style="font-weight: bold;">裝置序號：{{ deviceSN }}</span>
        <div class="flexRow">
          <mat-form-field style="width: 160px;">
            <input matInput [matDatepicker]="picker"
              placeholder="{{'universal_time_startDate' | translate}}"
              (dateChange)="handleDateChange($event, true)"
              [(ngModel)]="logTimeSelect.filterStartTime"
              [max]="logTimeSelect.filterEndTime"
            >
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker [touchUi]="isMobile" #picker startView="year"></mat-datepicker>
          </mat-form-field>
          <div class="flexRow" style="align-items: center; margin: 10px;">~</div>
          <mat-form-field style="width: 160px; margin-right: 10px;">
            <input matInput [matDatepicker]="picker2"
              placeholder="{{'universal_time_endDate' | translate}}"
              (dateChange)="handleDateChange($event, false)"
              [(ngModel)]="logTimeSelect.filterEndTime"
              [min]="logTimeSelect.filterStartTime"
            >
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker [touchUi]="isMobile" #picker2 startView="year" [startAt]="logTimeSelect.filterEndTime"></mat-datepicker>
          </mat-form-field>
          <button mat-raised-button mat-icon-button style="background-color: #26abe3;color: #fff"
            (click)="getProductLog()"
          >
            <mat-icon>search</mat-icon>
          </button>
        </div>
      </section>
      <div>
        <mat-paginator
          #paginatorA
          [length]="uiFlag.totalCount"
          [pageIndex]="currentPage?.pageIndex"
          [pageSize]="currentPage?.pageSize"
          [pageSizeOptions]="[5, 10, 15]"
        >
        </mat-paginator>
      </div>
      <section>
        <div class="flexRow productlog__table__titile">
          <span id="log__time__title">發生時間</span>
          <span id="update__time__title">上傳時間</span>
          <span id="log__message__title">訊息</span>
        </div>
        <div class="flexRow" style="margin-top: 20px; justify-content: center;" *ngIf="uiFlag.isTableLoading">
          <mat-spinner></mat-spinner>
        </div>
        <span style="color: rgba(150, 150, 150, 1);" *ngIf="!uiFlag.isTableLoading && uiFlag.noTableData">無資料顯示</span>
        <div *ngIf="!uiFlag.isTableLoading && !uiFlag.noTableData">
          <div class="flexRow productlog__table__content" *ngFor="let _log of logList;">
            <span class="log__time__content">
              {{ _log.logTime | timeFormat: 'YYYY-MM-DD HH:mm:ss' }}
            </span>
            <span class="update__time__content">
              {{ _log.uploadTime  | timeFormat: 'YYYY-MM-DD HH:mm:ss' }}
            </span>
            <span class="log__message__content">
              {{ _log.code }}: {{ ('errorCode_' + modelTypeName + '_' + _log.code) | productErrorLog }}
            </span>
          </div>
        </div>
      </section>
      <div>
        <mat-paginator
          #paginatorB
          [length]="uiFlag.totalCount"
          [pageIndex]="currentPage?.pageIndex"
          [pageSize]="currentPage?.pageSize"
          [pageSizeOptions]="[5, 10, 15]"
        >
        </mat-paginator>
      </div>
    </main>
  </ng-container>
</div>
