<div class="group-info row">
  <span class="group-handle-name group-handle-name__rwd">
    群組資訊
  </span>
  <div class="col-md-4 group-image--area">
    <img *ngIf="groupImg"
      [src]="(groupImg | safeHtml)"
      [class.image-is--default]="groupImg === '/assets/images/group-default.svg'"
    >
    <ul class="nav">
      <li [class.active]="chooseIdx === 1"
        (click)="handleGroupItem(1)"
      >群組資訊</li>
      <li [class.active]="chooseIdx === 2"
        *ngIf="groupLevel === '30' && visitorDetail?.isCanManage"
        (click)="handleGroupItem(2)"
      >品牌管理</li>
      <li [class.active]="chooseIdx === 3"
        (click)="handleGroupItem(3)"
      >隱私設定</li>
    </ul>
  </div>
  <div class="col-md-8">
    <ng-container *ngIf="chooseIdx === 1">
      <div class="group-edit-bar">
        <span class="group-handle-name">
          群組資訊
        </span>
        <div>
          <button class="alatech-btn alatech-btn--default"
            title="申請加入"
            *ngIf="(joinStatus === 5 || joinStatus === 3 ) && (!visitorDetail?.isGroupAdmin || groupLevel === '80')"
            (click)="handleActionGroup(1)"
          >
            申請加入
          </button>
          <button class="alatech-btn alatech-btn--default group-btn--waiting"
            title="取消申請"
            *ngIf="joinStatus === 1"
            (click)="handleActionGroup(2)"
          >
            取消申請
          </button>
          <button class="alatech-btn alatech-btn--default"
            title="退出群組"
            *ngIf="joinStatus === 2 &&
            (!visitorDetail?.isGroupAdmin
            ||
            (groupLevel === '80' && normalGroupAdministrators && normalGroupAdministrators?.length > 1)
            ||
            (groupLevel === '40' && branchAdministrators && branchAdministrators?.length > 1)
            )"
            (click)="handleActionGroup(2)"
          >
            退出群組
          </button>
          <button class="alatech-btn alatech-btn--default"
            title="管理"
            *ngIf="visitorDetail?.isCanManage"
            (click)="goEditPage()"
          >
            管理
          </button>
        </div>
      </div>
      <div style="margin-bottom: 30px;">
        <div>
          <label>
            <span *ngIf="groupLevel === '40' || groupLevel === '60'">
              {{groupInfo?.groupRootInfo[2].brandName}} -
            </span>
            <span *ngIf="groupLevel === '60'">
              {{groupInfo?.groupRootInfo[3].branchName}} -
            </span>
            {{ groupInfo?.groupName }}
          </label>
        </div>
        <div>
          <label>群組ID：</label>{{ group_id }}
        </div>
        <div>
          <label>階層：</label>{{ this.groupLevel | groupLevelTranslate }}
        </div>
        <div>
          <label>狀態：</label>{{ groupInfo?.groupStatus | groupStatus }}
        </div>
        <div>
          <label>介紹：</label>
          <div [innerHTML]="groupInfo?.groupDesc | lineBreak"></div>
        </div>
      </div>
      <div>
        <mat-tab-group (selectedTabChange)="changeGroupInfo($event)" class="ala-tab-group">
          <mat-tab label="子群組資訊" *ngIf="groupLevel !== '80'">
            <ng-container  *ngIf="!isLoading">
              <label style="color: #26abe3; font-weight: 700;margin-bottom: 15px">品牌</label>
              <div style="margin-bottom: 15px">
                <span *ngIf="subBrandInfo && subBrandInfo.length === 0">尚無品牌資訊</span>
                <ng-container  *ngFor="let subBrandItem of subBrandInfo">
                  <app-member-capsule
                    [role]="role"
                    [isSubGroupInfo]="true"
                    [title]="subBrandItem?.groupName"
                    [memberInfo]="subBrandItem"
                    [name]="subBrandItem && subBrandItem?.groupName"
                    [icon]="subBrandItem?.groupIcon"
                    [groupId]="subBrandItem?.groupId"
                  >
                  </app-member-capsule>
                </ng-container>
              </div>
              <label style="color: #26abe3; font-weight: 700;margin-bottom: 15px">分店</label>
              <div style="margin-bottom: 15px">
                <span *ngIf="subBranchInfo && subBranchInfo.length === 0">尚無分店資訊</span>
                <ng-container  *ngFor="let subBranchItem of subBranchInfo">
                  <app-member-capsule
                    [role]="role"
                    [isSubGroupInfo]="true"
                    [title]="subBranchItem?.groupName"
                    [memberInfo]="subBranchItem"
                    [name]="subBranchItem && subBranchItem?.groupName"
                    [icon]="subBranchItem?.groupIcon"
                    [groupId]="subBranchItem?.groupId"
                  >
                  </app-member-capsule>
                </ng-container>
              </div>

              <label style="color: #26abe3; font-weight: 700;margin-bottom: 15px">教練課</label>
              <div style="margin-bottom: 15px" >
                <span *ngIf="subCoachInfo && subCoachInfo.length === 0">尚無教練課資訊</span>
                <ng-container  *ngFor="let subCoachItem of subCoachInfo">
                  <app-member-capsule
                    [role]="role"
                    [isSubGroupInfo]="true"
                    [title]="subCoachItem?.groupName"
                    [memberInfo]="subCoachItem"
                    [name]="subCoachItem && subCoachItem?.groupName"
                    [icon]="subCoachItem?.groupIcon"
                    [groupId]="subCoachItem?.groupId"
                  >
                  </app-member-capsule>
                </ng-container>
              </div>
            </ng-container>
            <div style="display:flex;justify-content: center;align-items: center;height:100%"
              *ngIf="isLoading"
            >
              <mat-spinner></mat-spinner>
            </div>
          </mat-tab>
          <mat-tab label="管理員資訊">
            <ng-container *ngIf="!isLoading">
              <ng-container *ngIf="groupLevel && groupLevel !== '80'">
                <label style="color: #26abe3; font-weight: 700;margin-bottom: 15px">品牌管理員</label>
                <div style="margin-bottom: 15px">
                <span *ngIf="brandAdministrators && brandAdministrators.length === 0">尚無品牌管理員資訊</span>
                  <ng-container  *ngFor="let brandAdmItem of brandAdministrators">
                    <app-member-capsule
                      [role]="role"
                      [isAdminInfo]="true"
                      [title]="brandAdmItem?.memberName"
                      [memberInfo]="brandAdmItem"
                      [name]="brandAdmItem && brandAdmItem?.memberName"
                      [icon]="brandAdmItem?.memberIcon"
                      [userId]="brandAdmItem?.memberId"
                    >
                    </app-member-capsule>
                  </ng-container>
                </div>

                <label style="color: #26abe3; font-weight: 700;margin-bottom: 15px">分店管理員</label>
                <div style="margin-bottom: 15px">
                  <span *ngIf="branchAdministrators && branchAdministrators.length === 0">尚無分店管理員資訊</span>
                  <ng-container  *ngFor="let branchAdmItem of branchAdministrators">
                    <app-member-capsule
                      [role]="role"
                      [isAdminInfo]="true"
                      [title]="branchAdmItem?.memberName"
                      [memberInfo]="branchAdmItem"
                      [name]="branchAdmItem && branchAdmItem?.memberName"
                      [icon]="branchAdmItem?.memberIcon"
                      [userId]="branchAdmItem?.memberId"
                    >
                    </app-member-capsule>
                  </ng-container>
                </div>
                <ng-container *ngIf="groupLevel !== '60'">
                  <label style="color: #26abe3; font-weight: 700;margin-bottom: 15px">教練課管理員</label>
                  <div style="margin-bottom: 15px" >
                    <span *ngIf="coachAdministrators && coachAdministrators.length === 0">尚無教練課管理員資訊</span>
                    <ng-container  *ngFor="let coachAdmItem of coachAdministrators">
                      <app-member-capsule
                        [role]="role"
                        [isAdminInfo]="true"
                        [title]="coachAdmItem?.memberName"
                        [memberInfo]="coachAdmItem"
                        [name]="coachAdmItem && coachAdmItem?.memberName"
                        [icon]="coachAdmItem?.memberIcon"
                        [userId]="coachAdmItem?.memberId"
                      >
                      </app-member-capsule>
                    </ng-container>
                  </div>
                </ng-container>
                <ng-container *ngIf="groupLevel === '60'">
                  <label style="color: #26abe3; font-weight: 700;margin-bottom: 15px">專業老師</label>
                  <div style="margin-bottom: 15px" >
                    <span *ngIf="normalCoaches && normalCoaches.length === 0">尚無專業老師資訊</span>
                    <ng-container  *ngFor="let normalCoachAdmItem of normalCoaches">
                      <app-member-capsule
                        [role]="role"
                        [isAdminInfo]="true"
                        [title]="normalCoachAdmItem?.memberName"
                        [memberInfo]="normalCoachAdmItem"
                        [name]="normalCoachAdmItem && normalCoachAdmItem?.memberName"
                        [icon]="normalCoachAdmItem?.memberIcon"
                        [userId]="normalCoachAdmItem?.memberId"
                      >
                      </app-member-capsule>
                    </ng-container>
                  </div>
                  <label style="color: #26abe3; font-weight: 700;margin-bottom: 15px">體適能教練</label>
                  <div style="margin-bottom: 15px" >
                    <span *ngIf="PFCoaches && PFCoaches.length === 0">尚無體適能教練資訊</span>
                    <ng-container  *ngFor="let pfCoachAdmItem of PFCoaches">
                      <app-member-capsule
                        [role]="role"
                        [isAdminInfo]="true"
                        [title]="pfCoachAdmItem?.memberName"
                        [memberInfo]="pfCoachAdmItem"
                        [name]="pfCoachAdmItem && pfCoachAdmItem?.memberName"
                        [icon]="pfCoachAdmItem?.memberIcon"
                        [userId]="pfCoachAdmItem?.memberId"
                      >
                      </app-member-capsule>
                    </ng-container>
                  </div>
                </ng-container>
              </ng-container>
              <ng-container *ngIf="groupLevel && groupLevel === '80'">
                <label style="color: #26abe3; font-weight: 700;margin-bottom: 15px">管理員</label>
                <div style="margin-bottom: 15px" >
                  <span *ngIf="groupInfos && groupInfos.length === 0">尚無管理員資訊</span>
                  <ng-container  *ngFor="let item of groupInfos">
                    <app-member-capsule
                      [role]="role"
                      [isAdminInfo]="true"
                      [title]="item?.memberName"
                      [memberInfo]="item"
                      [name]="item && item?.memberName"
                      [icon]="item?.memberIcon"
                      [userId]="item?.memberId"
                    >
                    </app-member-capsule>
                  </ng-container>
                </div>
              </ng-container>
            </ng-container>
            <div style="display:flex;justify-content: center;align-items: center;height:100%"
              *ngIf="isLoading"
            >
              <mat-spinner></mat-spinner>
            </div>
          </mat-tab>
          <mat-tab label="一般成員資訊">
            <ng-container *ngIf="!isLoading">
              <span *ngIf="normalMemberInfos && normalMemberInfos.length === 0">尚無一般成員資訊</span>
              <ng-container  *ngFor="let item of normalMemberInfos">
                <div style="margin-bottom: 15px;display:inline-block">
                  <app-member-capsule
                    [role]="role"
                    [isNormalMemberInfo]="true"
                    [title]="item?.memberName"
                    [memberInfo]="item"
                    [name]="item && item?.memberName"
                    [icon]="item?.memberIcon"
                    [userId]="item?.memberId"
                  >
                  </app-member-capsule>
                </div>
              </ng-container>
            </ng-container>
            <div style="display:flex;justify-content: center;align-items: center;height:100%"
              *ngIf="isLoading"
            >
              <mat-spinner></mat-spinner>
            </div>
          </mat-tab>
          <mat-tab label="待加入成員">
            <ng-container *ngIf="!isLoading">
              <span *ngIf="groupInfos && groupInfos.length === 0">尚無待加入成員資訊</span>
              <ng-container  *ngFor="let item of groupInfos">
                <div style="margin-bottom: 15px;display:inline-block">
                  <app-member-capsule
                    [role]="role"
                    [isWaittingMemberInfo]="true"
                    [title]="item?.memberName"
                    [memberInfo]="item"
                    [name]="item && item?.memberName"
                    [icon]="item?.memberIcon"
                    [userId]="item?.memberId"
                  >
                  </app-member-capsule>
                </div>
              </ng-container>
            </ng-container>
            <div style="display:flex;justify-content: center;align-items: center;height:100%"
              *ngIf="isLoading"
            >
              <mat-spinner></mat-spinner>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </ng-container>
    <ng-container *ngIf="chooseIdx === 2 && !isCommerceInfoLoading">
      <label  class="group-label">
        品牌
      </label>
      <div class="group-list">
        <div class="group-list-item">狀態：
          <span *ngIf="commerceInfo?.commerceStatus === '1'">營運中</span>
          <span *ngIf="commerceInfo?.commerceStatus === '2'">停運中</span>
          <span *ngIf="commerceInfo?.commerceStatus === '3'">歇業</span>
          <span *ngIf="commerceInfo?.commerceStatus === '4'">待註銷</span>
        </div>
      </div>
      <label  class="group-label">
        總成員
      </label>
      <div class="group-list">
        <div class="group-list-item">管理員數：
          {{
            +commerceInfo?.groupManagerStatus.currentBrandManagers + +commerceInfo?.groupManagerStatus.currentBranchManagers
            + +commerceInfo?.groupManagerStatus.currentFitnessCoaches + +commerceInfo?.groupManagerStatus.currentCoaches + +commerceInfo?.groupManagerStatus.currentGeneralGroupManagers
          }}/{{commerceInfo?.groupManagerStatus.maxGroupManagers}}人
        </div>
        <div class="group-list-item">總人員數：
          {{+commerceInfo?.groupMemberStatus.currentGroupMembers}}/{{+commerceInfo?.groupMemberStatus.maxGroupMembers}}人</div>
      </div>
      <label  class="group-label">
        目前方案
      </label>
      <div class="group-list">
        <div class="group-list-item">目前方案：
          <span *ngIf="commerceInfo?.commercePlan === '1'">試用</span>
          <span *ngIf="commerceInfo?.commercePlan === '2'">工作室方案</span>
          <span *ngIf="commerceInfo?.commercePlan === '3'">中小型企業方案</span>
          <span *ngIf="commerceInfo?.commercePlan === '99'">客制化</span>
        </div>
        <div class="group-list-item">授權到期日：
          {{(commerceInfo?.commercePlanExpired) | date: 'y/MM/dd'}}</div>
      </div>
      <label  class="group-label">
        群組數量
      </label>
      <div class="group-list">
        <div class="group-list-item">分店數：{{commerceInfo?.groupStatus.currentBranches}}/{{commerceInfo?.groupStatus.maxBranches}}</div>
        <div class="group-list-item">課程數：{{commerceInfo?.groupStatus.currentClasses}}/{{commerceInfo?.groupStatus.maxClasses}}</div>
      </div>
      <label  class="group-label">
        管理成員
      </label>
      <div class="group-list">
        <div class="group-list-item">品牌管理員：{{commerceInfo?.groupManagerStatus.currentBrandManagers}}人</div>
        <div class="group-list-item">分店管理員：{{commerceInfo?.groupManagerStatus.currentBranchManagers}}人</div>
        <div class="group-list-item">健體教練：{{commerceInfo?.groupManagerStatus.currentFitnessCoaches}}人</div>
        <div class="group-list-item">專業老師：{{commerceInfo?.groupManagerStatus.currentCoaches}}人</div>
      </div>
    </ng-container>
    <ng-container *ngIf="chooseIdx === 3">
      <label  class="group-label">
        群組成員可見度
      </label>
      <div class="group-list">
        <div class="group-list-item">
          <span *ngIf="groupInfo?.shareAvatarToMember && groupInfo?.shareAvatarToMember.switch === '1'">"所有成員"皆可以看到頭像與暱稱</span>
          <span *ngIf="groupInfo?.shareAvatarToMember && groupInfo?.shareAvatarToMember.switch === '2'">不開放頭像與暱稱</span>
          <span *ngIf="groupInfo?.shareAvatarToMember && (groupInfo?.shareAvatarToMember.switch === '3' || groupInfo?.shareAvatarToMember.switch === '4')">
            {{shareAvatarTarget}}
          </span>
        </div>
      </div>
      <label  class="group-label">
        分享運動檔案
      </label>
      <div class="group-list">
        <div class="group-list-item">
          <span *ngIf="groupInfo?.shareActivityToMember && groupInfo?.shareActivityToMember.switch === '1'">"所有成員"皆可以看到運動檔案</span>
          <span *ngIf="groupInfo?.shareActivityToMember && groupInfo?.shareActivityToMember.switch === '2'">不開放運動檔案</span>
          <span *ngIf="groupInfo?.shareActivityToMember && (groupInfo?.shareActivityToMember.switch === '3' || groupInfo?.shareActivityToMember.switch === '4')">
            {{shareActivityTarget}}
          </span>
        </div>
      </div>
      <label  class="group-label">
        分享運動報告
      </label>
      <div class="group-list">
        <div class="group-list-item">
          <span *ngIf="groupInfo?.shareReportToMember && groupInfo?.shareReportToMember.switch === '1'">"所有成員"皆可以看到運動報告</span>
          <span *ngIf="groupInfo?.shareReportToMember && groupInfo?.shareReportToMember.switch === '2'">不開放運動報告</span>
          <span *ngIf="groupInfo?.shareReportToMember && (groupInfo?.shareReportToMember.switch === '3' || groupInfo?.shareReportToMember.switch === '4')">
            {{shareReportTarget}}
          </span>
        </div>
      </div>
    </ng-container>
    <div style="display:flex;justify-content: center;align-items: center;height:100%"
      *ngIf="isCommerceInfoLoading"
    >
      <mat-spinner></mat-spinner>
    </div>
  </div>
</div>
<div class="group-manage__action" #footerTarget>
  <button class="alatech-btn group-manage__btn"
    title="申請加入"
    *ngIf="(joinStatus === 5 || joinStatus === 3 ) && (!visitorDetail?.isGroupAdmin || groupLevel === '80')"
    (click)="handleActionGroup(1)"
  >
    申請加入
  </button>
  <button class="alatech-btn group-manage__btn group-btn--waiting"
    title="取消申請"
    *ngIf="joinStatus === 1"
    (click)="handleActionGroup(2)"
  >
    取消申請
  </button>
  <button class="alatech-btn group-manage__btn"
    title="退出群組"
    *ngIf="joinStatus === 2 &&
    (!visitorDetail?.isGroupAdmin
    ||
    (groupLevel === '80' && normalGroupAdministrators && normalGroupAdministrators?.length > 1)
    ||
    (groupLevel === '40' && branchAdministrators && branchAdministrators?.length > 1)
    )"
    (click)="handleActionGroup(2)"
  >
    退出群組
  </button>
  <button class="alatech-btn group-manage__btn"
    title="管理"
    *ngIf="visitorDetail?.isCanManage"
    (click)="goEditPage()"
  >
    管理
  </button>
</div>
