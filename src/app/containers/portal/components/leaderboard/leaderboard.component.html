<div class="leaderboard-bg" [style.background-image]="bgImageUrl" *ngIf="!isLoading">
  <div class="leaderboard-layer">
    <div class="container leaderboard-rwd">
      <div style="margin: -5px -15px 0px;border-bottom: 5px solid #26ABE4">
        <ul class="tablist">
          <li class="tablist__tab"
            title="一般賽事排行版"
            [class.tablist__tab--selected]="tabIdx === 0"
            (click)="selectTab(0)"
          >
            一般賽事排行版
          </li>
          <li class="tablist__tab"
            title="第一屆英達高空夜跑賽"
            [class.tablist__tab--selected]="tabIdx === 1"
            (click)="selectTab(1)"
          >
            第一屆英達高空夜跑賽
          </li>
          <li class="tablist__tab"
            title="ISPO"
            [class.tablist__tab--selected]="tabIdx === 2"
            (click)="selectTab(2)"
          >
            ISPO
          </li>
        </ul>
      </div>
      <div class="row row-runs">
        <div class="searchRank-bar" style="width: 100%">
          <form (ngSubmit)="onSubmit(rankForm, $event)" #rankForm="ngForm">
            <div class="row">
              <div class="col-10">
                <label class="form-label">Map:</label>
                <select name="mapId" [(ngModel)]="mapId" class="form-field" (click)="selectMap(mapId)">
                  <option *ngFor="let _map of mapDatas" [value]="_map.map_id">{{ _map.map_name }}</option>
                </select>

                <label class="form-label" style="margin-left: 28px;">Email:</label>
                <div class="dropdown" (click)="openActive($event)">
                  <div class="clearable">
                    <input type="email" name="email" [(ngModel)]="email" (keyup)="inputEvent($event)" autocomplete="off" [class.loading]="isSelectLoading"
                      class="form-field" placeholder="enter email" (focus)="focusEvent($event)" style="width: 300px;text-overflow: ellipsis;">
                    <i class="clearable__clear" [class.show]="isClearIconShow" (click)="clear()">&times;</i>
                    <i class="fa fa-caret-down async-caret"></i>
                    <i class="fa fa-spinner fa-pulse fa-1x fa-fw spinner" [class.spinner-hidden]="!isSelectLoading"></i>
                  </div>
                  <ul class="dropdown-menu" style="width: 100%;" *ngIf="emailOptions && emailOptions.length > 0" [class.show]="active && emailOptions.length > 0">
                    <li *ngFor="let o of emailOptions; let i = index" (click)="remove(i, $event)">
                      <a>
                        {{ o }}
                      </a>
                    </li>
                  </ul>
                </div>
                <div style="display: inline-block">
                  <label class="form-label">組別:</label>
                  <select name="groupId" [(ngModel)]="groupId" class="form-field">
                    <option [value]="2">無分組</option>
                    <option [value]="0">男生組</option>
                    <option [value]="1">女生組</option>
                  </select>
                  <ng-container *ngIf="!tabIdx">
                    <label class="form-label">Date:</label>
                    <my-date-picker name="selectedStartDate"
                      class="rank__datepicker"
                      [options]="startDateOptions"
                      [(ngModel)]="startDay"
                      required
                    >
                    </my-date-picker>
                    <div style="margin: 0px 5px;display: inline-block;vertical-align: text-bottom;">~</div>

                    <my-date-picker name="selectedEndDate"
                      class="rank__datepicker"
                      [options]="endDateOptions"
                      [(ngModel)]="finalDay"
                      required
                    >
                    </my-date-picker>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-2">
                <button type="submit" class="button search-form__button">
                  <i class="fa fa-search"></i>
                </button>
              </div>
            </div>
          </form>
          <div class="summary">
            本月進行的例行排行賽為
            <span style="color: #157fcc;font-weight: 700">指定地圖{{ mapName }}{{ distance }}KM</span>
            <div>排行榜於每日06:00刷新，最終排名以{{ finalEventDate || '當月最後一日' }} 23:59結算成績為主</div>
          </div>
        </div>
        <div class="searchRank-mapInfo"><span style="color: #008bcd;font-weight: 700">指定地圖{{ mapName }}{{ distance }}KM</span></div>
        <div class="table-responsive">
          <table class="table table-rwd">
            <thead>
              <tr class="">
                <th class="ranking-table__cell--head">Rank</th>
                <th class="ranking-table__cell--head">UserName</th>
                <th class="ranking-table__cell--head">Gender</th>
                <th class="ranking-table__cell--head">Offical Time</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rankDatas" [ngClass]="{'here' : (data.e_mail === email) && isFoundUser}"
               (click)="toMapInfoPage(data.user_id)" class="ranking-link"
              >
                <td class="ranking-table__cell"
                  data-th="Rank"
                >
                  <a class="ranking-link">{{ data.rank }}</a>
                </td>
                <td class="ranking-table__cell" data-th="UserName">{{ data.login_acc }}</td>
                <td class="ranking-table__cell" data-th="Gender">{{ data.gender | sex }}</td>
                <td class="ranking-table__cell" data-th="Offical Time">{{ data.offical_time | time }}</td>
              </tr>
              <tr *ngIf="!isHaveDatas">
                <td class="ranking-table__cell no-data" colspan="4" style="text-align: center">
                  尚無相關資訊
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="4" *ngIf="!isHaveEmail">
                  <ng-container *ngIf="isHaveDatas">
                    <app-pagination (onChange)="onPageChange($event)"
                      [maxPage]="meta.maxPage"
                      [currentPage]="meta.currentPage"
                      [total]="meta.total"
                    ></app-pagination>
                  </ng-container>
                </td>
              </tr>
            </tfoot>
          </table>
        </div>

        <div>
          <button title="previous map" (click)="preMap()" class="button bg-btn" style="position: absolute;left: 0;top: 50%;">
            <i class="fa fa-arrow-left" aria-hidden="true"></i>
          </button>
          <button title="next map" (click)="nextMap()" class="button bg-btn" style="position: absolute;right: 0;top: 50%;">
            <i class="fa fa-arrow-right" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<div *ngIf="isLoading">
  <app-loading></app-loading>
</div>
