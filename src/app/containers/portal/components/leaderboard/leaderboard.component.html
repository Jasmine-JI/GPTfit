<div class="leaderboard-bg" [style.background-image]="bgImageUrl" *ngIf="!isLoading">
  <div class="leaderboard-layer">
    <div class="container leaderboard-rwd">
      <div style="margin: -5px -15px 0px;border-bottom: 5px solid #26ABE4">
        <ul class="tablist">
          <li class="tablist__tab"
            title="一般賽事排行版"
            [class.tablist__tab--selected]="tabIdx === 0"
            (click)="selectTab(0)"
          >
             General
          </li>
          <ng-container *ngFor="let tab of rankTabs;let _tabIdx = index">
            <li class="tablist__tab"
              title="{{tab.session_name}}"
              (click)="selectTab(_tabIdx + 1)"
              [class.tablist__tab--selected]="tabIdx === _tabIdx + 1"
            >
              {{ tab.session_name }}
            </li>
          </ng-container>
        </ul>
      </div>
      <div class="row row-runs">
        <div class="searchRank-bar" style="width: 100%">
          <form (ngSubmit)="onSubmit(rankForm, $event)" #rankForm="ngForm">
            <div class="row">
              <div class="col-11">
                <label class="form-label">Map:</label>
                <select  *ngIf="!isRealTime || tabIdx === 0" name="mapId" [(ngModel)]="mapId" class="form-field" (click)="selectMap(mapId)">
                  <option *ngFor="let _map of mapDatas" [value]="_map.map_id">{{ _map.map_name }}</option>
                </select>
                <select *ngIf="isRealTime && tabIdx > 0" name="mapId" [(ngModel)]="mapId" class="form-field" (click)="selectMap(mapId)">
                  <option *ngFor="let _map of mapDatas" [value]="_map.map_id">{{ _map.map_name | mapTranslate }}</option>
                </select>
                <label class="form-label" style="margin-left: 5px">Group:</label>
                <select name="groupId" [(ngModel)]="groupId" class="form-field">
                  <option [value]="2">No grouping</option>
                  <option [value]="0">Male</option>
                  <option [value]="1">Female</option>
                </select>
                  <ng-container *ngIf="!tabIdx">
                    <div style="display: inline-block">
                      <label class="form-label">Date:</label>
                      <my-date-picker name="selectedStartDate"
                        class="rank__datepicker"
                        [options]="startDateOptions"
                        [(ngModel)]="startDay"
                        required
                      >
                      </my-date-picker>
                      <div style="margin: 0px 5px;display: inline-block;vertical-align: text-bottom;">~</div>

                      <my-date-picker name="selectedEndDate"
                        class="rank__datepicker"
                        [options]="endDateOptions"
                        [(ngModel)]="finalDay"
                        required
                      >
                      </my-date-picker>
                    </div>
                  </ng-container>
                <div style="display: inline-block">
                  <label class="form-label">UserName:</label>
                    <div class="dropdown" (click)="openActive($event)">
                      <div class="clearable">
                        <input type="text" name="userName" [(ngModel)]="userName" (keyup)="inputEvent($event)" autocomplete="off" [class.loading]="isSelectLoading"
                          class="form-field" placeholder="enter user name" (focus)="focusEvent($event)" style="width: 300px;text-overflow: ellipsis;">
                        <i class="clearable__clear" [class.show]="isClearIconShow" (click)="clear()">&times;</i>
                        <i class="fa fa-caret-down async-caret"></i>
                        <i class="fa fa-spinner fa-pulse fa-1x fa-fw spinner" [class.spinner-hidden]="!isSelectLoading"></i>
                      </div>
                      <ul class="dropdown-menu" style="width: 100%;" *ngIf="emailOptions && emailOptions.length > 0" [class.show]="active && emailOptions.length > 0">
                        <li *ngFor="let o of emailOptions; let i = index" (click)="remove(i, $event)">
                          <a>
                            {{ o }}
                          </a>
                        </li>
                      </ul>
                    </div>
                </div>
              </div>
              <div class="col-md-1">
                <button type="submit" class="button search-form__button">
                  <i class="fa fa-search"></i>
                </button>
              </div>
            </div>
          </form>
          <div class="summary" *ngIf="!isRealTime || tabIdx === 0">
            本月進行的例行排行賽為
            <span style="color: #157fcc;font-weight: 700">指定地圖{{ mapName }}{{ distance }}KM</span>
            <div>排行榜於每日06:00刷新，最終排名以{{ finalEventDate || '當月最後一日 23:59' }} 結算成績為主</div>
          </div>
          <div class="summary" *ngIf="isRealTime && tabIdx > 0">
             The event with specify map
            <span style="color: #157fcc;font-weight: 700">{{ mapName | mapTranslate }} {{ distance }}KM</span>
            <div> Refresh every 5 minutes after leaderboard page loading, the final ranking settlement results based on {{ finalEventDate }}</div>
          </div>
        </div>
        <div class="searchRank-mapInfo">
          <span style="color: #008bcd;font-weight: 700"
            *ngIf="!isRealTime || tabIdx === 0 "
          >
            {{ mapName }}{{ distance }}KM
          </span>
          <span style="color: #008bcd;font-weight: 700"
           *ngIf="isRealTime && tabIdx > 0"
          >
            {{ mapName | mapTranslate }}{{ distance }}KM
          </span>
        </div>
        <div class="table-responsive">
          <table class="table table-rwd">
            <thead>
              <tr class="">
                <th class="ranking-table__cell--head">Rank</th>
                <th class="ranking-table__cell--head">UserName</th>
                <th class="ranking-table__cell--head">Gender</th>
                <th class="ranking-table__cell--head">Offical Time</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of rankDatas" [ngClass]="{'here' : ((data.login_acc === userName) && isFoundUser && userName.length > 0)}"
               (click)="toMapInfoPage(data.user_id)" class="ranking-link"
              >
                <td class="ranking-table__cell"
                  data-th="Rank"
                >
                  <ng-container *ngIf="(data.rank !==  '1' && data.rank !==  '2' && data.rank !==  '3') || finalEventStamp > currentDate || tabIdx === 0">
                    <a class="ranking-link">{{ data.rank }}</a>
                  </ng-container>
                  <ng-container *ngIf="data.rank === '1' && finalEventStamp < currentDate && tabIdx > 0">
                    <svg class="medal" xmlns='http://www.w3.org/2000/svg' width='100%' height='100%' viewBox='0 0 100 100' preserveAspectRatio='xMidYMid meet'><circle cx='50' cy='50' r='45' fill='gold' stroke='goldenrod' stroke-width='5'/><text x='50' y='50' text-anchor='middle' style='font-family:Arial, Helvetica, sans-serif; font-size:24; stroke:brown; fill:goldenrod;  dominant-baseline: middle;' textLength='85' >GOLD</text></svg>
                  </ng-container>
                  <ng-container *ngIf="data.rank === '2' && finalEventStamp < currentDate && tabIdx > 0">
                    <svg class="medal" xmlns='http://www.w3.org/2000/svg' width='100%' height='100%' viewBox='0 0 100 100' preserveAspectRatio='xMidYMid meet'><circle cx='50' cy='50' r='45' fill='silver' stroke='SteelBlue' stroke-width='5'/><text x='50' y='50' text-anchor='middle' style='font-family:Arial, Helvetica, sans-serif; font-size:24; fill:SteelBlue; stroke:SlateGray;  dominant-baseline: middle;' textLength='85' >SILVER</text></svg>
                  </ng-container>
                  <ng-container *ngIf="data.rank === '3' && finalEventStamp < currentDate && tabIdx > 0">
                    <svg class="medal" xmlns='http://www.w3.org/2000/svg' width='100%' height='100%' viewBox='0 0 100 100' preserveAspectRatio='xMidYMid meet'><circle cx='50' cy='50' r='45' fill='goldenrod' stroke='chocolate' stroke-width='5'/><text x='50' y='50' text-anchor='middle' style='font-family:Arial, Helvetica, sans-serif; font-size:24; stroke:brown; fill:chocolate;  dominant-baseline: middle;' textLength='85' >BRONZE</text></svg>
                  </ng-container>
                </td>
                <td class="ranking-table__cell" data-th="UserName">{{ data.login_acc }}</td>
                <td class="ranking-table__cell" data-th="Gender">{{ data.gender | sex }}</td>
                <td class="ranking-table__cell" data-th="Offical Time">{{ data.offical_time | time }}</td>
              </tr>
              <tr *ngIf="!isHaveDatas">
                <td class="ranking-table__cell no-data" colspan="4" style="text-align: center">
                   Cannot find any information
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="4" *ngIf="!isHaveEmail" style="padding: 5px">
                  <ng-container *ngIf="isHaveDatas">
                    <app-pagination (onChange)="onPageChange($event)"
                      [maxPage]="meta.maxPage"
                      [currentPage]="meta.currentPage"
                      [total]="meta.total"
                    ></app-pagination>
                  </ng-container>
                </td>
              </tr>
            </tfoot>
          </table>
        </div>

        <div>
          <button title="previous map" (click)="preMap()" class="button bg-btn" style="position: absolute;left: 0;top: 50%;">
            <i class="fa fa-arrow-left" aria-hidden="true"></i>
          </button>
          <button title="next map" (click)="nextMap()" class="button bg-btn" style="position: absolute;right: 0;top: 50%;">
            <i class="fa fa-arrow-right" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<div *ngIf="isLoading">
  <app-loading></app-loading>
</div>
